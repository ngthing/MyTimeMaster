<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <!-- Add Bootstrap, Jquery -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- Customed CSS file -->
    <link rel="stylesheet" type="text/css" href="static-files/css/signup-style.css">

    <script src="https://fb.me/react-15.0.0.js"></script>
    <script src="https://fb.me/react-dom-15.0.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
    <!-- ReactFire -->
    <script src="https://cdn.firebase.com/libs/reactfire/1.0.0/reactfire.min.js"></script>
</head>
<body>
<div id="container"></div>

<script type="text/babel">
    "use strict";
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyB3d8PsIKe8MtzXqwcWrwFODZoUis2OIec",
        authDomain: "mytimemaster-7339f.firebaseapp.com",
        databaseURL: "https://mytimemaster-7339f.firebaseio.com",
        storageBucket: "mytimemaster-7339f.appspot.com",
        messagingSenderId: "405052553605"
    };
    firebase.initializeApp(config);

    var UserList = React.createClass({
        render: function () {
            var _this = this; //In the subcomponent, "this" will refer to window, so need to save "this" here
            var createItem = function (item, key) {
                return (<div key={key}>
                    <form onSubmit={this.handleSubmit}>

                        <div className="form-group">
                            <label> UserName </label>
                            <input type="name" onChange={_this.props.onChange.bind(null, item['.key'])} value={item.name} ref="name" placeholder="Username"/>
                        </div>

                        <div className="form-group">
                            <label> Email </label>
                            <input className="form-control" ref="email" placeholder="Email"/>
                        </div>

                        <div className="form-group">
                            <label>Password</label>
                            <input ref="pw" type="password" className="form-control" placeholder="Password" />
                        </div>

                        <button type="submit" className="btn btn-primary">Register</button>
                    </form>

                    <input type="name" onChange={_this.props.onChange.bind(null, item['.key'])} value={item.name}/>

                    <input type="email" onChange={_this.props.onChange.bind(null, item['.email'])}
                           value={item.email}/>

                    <input type="pw" onChange={_this.props.onChange.bind(null, item['.pw'])}
                           value={item.pw}/>

                </div>);
            };
            return <ul>{this.props.items.map(createItem)}</ul>;
        }
    });

    var Register = React.createClass({
        mixins: [ReactFireMixin],
        getInitialState: function () {
            return {items: []};
        },
        componentWillMount: function () {
            this.fireRef = firebase.database().ref('Users');

            this.bindAsArray(this.fireRef, "items");
        },

        onChange: function (fireKey, event) {
            this.fireRef.child(fireKey).set({
                "name": event.target.value,
                "email": event.target.value,
                "pw" :event.target.value
            });

        },

        handleSubmnit: function (e) {
            this.fireRef.push({
                "name": "",
                "email": "",
                "pw": ""
            });
            this.setState({
                name:"",
                email:"",
                pw: ""
            });

        },
        render: function () {
            return (
                    <div>

                        <div className="col-sm-6 col-sm-offset-3">
                            <h1> Register </h1>
                            <form onSubmit={this.handleSubmit}>
                                <UserList items={this.state.items} removeItem={this.removeItem} onChange={this.onChange}/>

                                <div className="form-group">
                                    <label> UserName </label>
                                    <input className="form-control" ref="name" placeholder="Username"/>
                                </div>
                                <div className="form-group">
                                    <label> Email </label>
                                    <input className="form-control" ref="email" placeholder="Email"/>
                                </div>

                                <div className="form-group">
                                    <label>Password</label>
                                    <input ref="pw" type="password" className="form-control" placeholder="Password" />
                                </div>

                                <button type="button" id = "submit" className="btn btn-primary" >Register</button>

                            </form>

                        </div>
                    </div>
            );
        }
    });

    ReactDOM.render(<Register />,

            document.getElementById('container'));


</script>

</body>
</html>
